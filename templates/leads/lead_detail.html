{% extends "dashboard.html" %}
{% load static %}

{% block content %}

<div class="model-container">
    <div class="title">
        <h1>Lead details</h1>
    </div>
    {% include "alerts.html" %}
    <div class="model-cont">
        <div class="model-content-field">
            <div class="model-cont-nav">
                <div class="nav-cont">
                    {% if user.is_superuser %}
                        {% if lead.company %}
                        <a href="{% url 'companies:company-detail' lead.company.slug %}">Company</a>
                        {% endif %}
                        {% if lead.team %}
                        <a href="{% url 'teams:team-detail' lead.team.slug %}">Team</a>
                        {% endif %}
                        {% if lead.agent %}
                        <a href="{% url 'agents:agent-detail' lead.agent.pk %}">Agent</a>
                        {% endif %}
                    {% endif %}
                    
                    {% if lead.team.manager.user == user or user in lead.team.memebers %}
                        {% if lead.team %}
                        <a href="{% url 'teams:team-detail' lead.team.slug %}">Team</a>
                        {% endif%}
                        {% if lead.team and lead.agent %}
                        <a href="{% url 'teams:agents:agent-detail' team.slug lead.agent.pk %}">Agent</a>
                        {% endif%}
                    {% endif%}
                </div>
                <div class="model-task-content-nt">
                    <div class="model-element">
                        <p><b>Lead: {{ lead.first_name }}</b></p>
                        <p><i class="fa-solid fa-building"></i> {{ lead.company }}</p>
                    </div>
                    <div class="model-element">
                        <p><i class="fa-solid fa-envelope"></i> {{ lead.email }}</p>
                        <p><i class="fa-solid fa-phone"></i> {{ lead.phone_number }}</p>
                    </div>
                </div>
            </div>
            <div class="model-content">
                <div class="model-element">
                    <div class="as-icone-container">
                        <p class="as-icone">Product</p><p class="lead-product"> {{ lead.get_product_display }}</p>
                    </div>
                </div>
                <div class="lead-msg">
                    <i class="fa-solid fa-comment"></i>
                    <p>{{ lead.message }}</p>
                </div>
            </div>
            <div class="model-content">
                <div class="model-element">
                    <p>{% if lead.agent is not None %}
                        <i class="fa-solid fa-user-tie"></i> {{ lead.agent.user.first_name}} {{ lead.agent.user.last_name }}
                        {% else %}
                        <i class="fa-solid fa-user-tie"></i> Not assigned
                        {% endif %}
                    </p>
                    <p>
                        {% if lead.team %}
                        <i class="fa-solid fa-people-group"></i> {{ lead.team }}
                        {% else %}
                        <i class="fa-solid fa-people-group"></i> Not assigned
                        {% endif %}
                    </p>
                </div>
                <div class="model-element">
                    <div class="as-icone-container">
                        <p class="as-icone">Status</p><p> {{ lead.status}} </p>
                    </div>
                </div>
                <div class="lead-msg">
                    <i class="fa-solid fa-note-sticky"></i>
                    <p>{{ lead.description }}</p>
                </div>
                <div class="model-element-action">
                    <a href="{% url 'leads:lead-list' %}"><i class="fa-solid fa-arrow-left"></i>Leads</a>
                </div>
            </div>
        </div>
        <div class="model-action-cont">
            <ul>
                {% if user.is_superuser %}
                <li>
                    {% if not lead.team %}
                    <a href="{% url 'leads:lead-assign-team' lead.pk %}">
                        <h3>Assign Team</h3>
                        <p class="det-icon"><i class="fa-solid fa-plus"></i><i class="fa-solid fa-people-group"></i></p>
                    </a>
                    {% else %}
                    <a href="{% url 'leads:lead-unassign-team' lead.pk %}">
                        <h3>Unassign Team</h3>
                        <p class="det-icon"><i class="fa-solid fa-minus"></i><i class="fa-solid fa-people-group"></i></p>
                    </a>
                    {% endif %}
                </li>
                <li>
                    {% if not lead.agent %}
                    <a href="{% url 'leads:lead-assign-agent' lead.pk %}">
                        <h3>Assign Agent</h3>
                        <p class="det-icon"><i class="fa-solid fa-plus"></i><i class="fa-solid fa-user-tie"></i></p>
                    </a>
                    {% else %}
                    <a href="{% url 'leads:lead-unassign-agent' lead.pk %}">
                        <h3>Unassign Agent</h3>
                        <p class="det-icon"><i class="fa-solid fa-minus"></i><i class="fa-solid fa-user-tie"></i></p>
                    </a>
                    {% endif %}
                </li>
                {% elif user.is_manager %}
                <li>
                    {% if not lead.agent %}
                    <a href="{% url 'teams:leads:lead-assign-agent' team.slug lead.pk %}">
                        <h3>Assign Agent</h3>
                        <p class="det-icon"><i class="fa-solid fa-plus"></i><i class="fa-solid fa-user-tie"></i></p>
                    </a>
                    {% else %}
                    <a href="{% url 'teams:leads:lead-unassign-agent' team.slug lead.pk %}">
                        <h3>Unassign Agent</h3>
                        <p class="det-icon"><i class="fa-solid fa-minus"></i><i class="fa-solid fa-user-tie"></i></p>
                    </a>
                    {% endif %}
                </li>
                {% endif %}
                <li>
                    {% if user.is_superuser %}
                    <a href="{% url 'leads:lead-update' lead.pk %}">
                    {% else %}
                    <a href="{% url 'teams:leads:lead-update' team.slug lead.pk %}">
                    {% endif %}
                        <h3>Update Lead</h3>
                        <p class="det-icon"><i class="fa-solid fa-pen-to-square"></i></p>
                    </a>
                </li>
                <li>
                    {% if user.is_superuser %}
                    <a href="{% url 'leads:lead-delete' lead.pk %}">
                    {% else %}
                    <a href="{% url 'teams:leads:lead-delete' team.slug lead.pk %}">
                    {% endif %}
                        <h3>Delete Lead</h3>
                        <p class="det-icon"><i class="fa-solid fa-trash"></i></p>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>

{% endblock content %}